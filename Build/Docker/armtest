FROM arm64v8/debian:stable-slim

EXPOSE 9118
WORKDIR /home

RUN apt-get update && apt-get install -y --no-install-recommends curl wget unzip chromium

RUN curl -fSL --output dotnet.tar.gz https://dotnetcli.azureedge.net/dotnet/Sdk/6.0.420/dotnet-sdk-6.0.420-linux-arm64.tar.gz \
    && mkdir -p /usr/share/dotnet \
    && tar -oxzf dotnet.tar.gz -C /usr/share/dotnet ./packs ./sdk ./sdk-manifests ./templates ./LICENSE.txt ./ThirdPartyNotices.txt \
    && rm dotnet.tar.gz \
    # Trigger first run experience by running arbitrary cmd
    && dotnet help

RUN wget https://github.com/immisterio/Lampac/releases/latest/download/publish.zip && \
	unzip -o publish.zip && rm -f publish.zip && rm -rf merchant && \
	touch isdocker

RUN echo '{"puppeteer":{"executablePath":"/usr/bin/chromium"}, "isarm":true, "mikrotik":true, "serverproxy":{"verifyip":false}}' > /home/init.conf

ENTRYPOINT ["dotnet", "Lampac.dll"]